<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY SPORT</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ†</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            padding: 15px;
        }

        .header {
            position: relative;
            text-align: center;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .last-update-text {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
            color: rgba(255,255,255,0.5);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 20px;
            height: calc(100vh - 80px);
            max-width: 75%;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            overflow: auto;
        }

        .card.in-season {
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 2px #ff9800;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            width: 100%;
        }

        .icon {
            width: 28px;
            height: 28px;
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid rgba(76, 175, 80, 0.5);
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #4caf50;
            font-size: 16px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .team-info h2 {
            font-size: 1.3rem;
            font-weight: 600;
            line-height: 1.2;
        }

        .league {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-left: auto;
            white-space: nowrap;
        }

        .stats {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }

        .rank-big {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin: 10px 0;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            white-space: nowrap;
            overflow: hidden;
        }

        .stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            flex-shrink: 0;
            white-space: nowrap;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .next-match-info, .recent-match-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-top: 8px;
        }

        .next-match-label, .recent-match-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 6px;
        }

        .opponent {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .match-details {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .match-separator {
            color: rgba(255, 255, 255, 0.4);
        }

        .no-match, .no-event, .no-data {
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        .result {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 5px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .result.win {
            background: rgba(76, 175, 80, 0.3);
            color: #81c784;
        }

        .result.loss {
            background: rgba(244, 67, 54, 0.3);
            color: #e57373;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .header h1 { font-size: 1.5rem; }
            .last-update-text { 
                position: static;
                transform: none;
                text-align: center;
                margin-top: 5px;
            }
            .dashboard { 
                gap: 10px; 
                max-width: 100%;
            }
            .card { 
                padding: 15px;
                justify-content: center;
                align-items: center;
            }
            
            /* ì•„ì´ì½˜ë§Œ í¬ê²Œ í‘œì‹œ */
            .card-header {
                flex-direction: column;
                margin-bottom: 0;
            }
            .icon { 
                width: 60px;
                height: 60px;
                font-size: 32px;
                border-radius: 12px;
            }
            
            /* ë‚˜ë¨¸ì§€ ë‚´ìš© ìˆ¨ê¹€ */
            .team-info,
            .stats,
            .rank-big,
            .stat-row,
            .next-match-info,
            .recent-match-info {
                display: none;
            }
        }
        
        /* D-day ìŠ¤íƒ€ì¼ */
        .dday {
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        .dday.ongoing {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .dday.upcoming {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.85;
                transform: scale(1.05);
            }
        }

        @media (max-width: 480px) {
            .icon { 
                width: 50px;
                height: 50px;
                font-size: 26px;
                border-radius: 10px;
            }
        }
        
        /* íƒœë¸”ë¦¿/ì¤‘ê°„ í™”ë©´ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dashboard {
                max-width: 85%;
                gap: 15px;
            }
        }
        
        /* ëŒ€í˜• í™”ë©´ */
        @media (min-width: 1400px) {
            .dashboard {
                max-width: 70%;
            }
        }
        
        /* ë°ìŠ¤í¬í†± ì‘ì€ í™”ë©´ì—ì„œ í°íŠ¸ í¬ê¸° ì¡°ì • */
        @media (min-width: 769px) and (max-width: 1200px) {
            .stat-label {
                font-size: 0.7rem;
            }
            .stat-value {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>MY SPORT</h1>
        <div id="last-update" class="last-update-text"></div>
    </div>

    <div class="dashboard" id="dashboard">
        <!-- ì¹´ë“œ ìˆœì„œëŠ” JavaScriptê°€ ë™ì ìœ¼ë¡œ ê²°ì • -->
    </div>

    <!-- ì¹´ë“œ í…œí”Œë¦¿ë“¤ (ìˆ¨ê¹€) -->
    <div id="card-templates" style="display: none;">
        <!-- ë°°êµ¬ ì¹´ë“œ -->
        <div class="card volleyball-card" data-card-type="volleyball" onclick="location.href='public/html/volleyball.html'" style="cursor: pointer;">
            <div class="card-header">
                <div class="icon">âœ“</div>
                <div class="team-info">
                    <h2>í˜„ëŒ€ìºí”¼íƒˆ ìŠ¤ì¹´ì´ì›Œì»¤ìŠ¤</h2>
                    <div class="league">V-ë¦¬ê·¸</div>
                </div>
            </div>
            <div class="stats">
                <div class="rank-big" id="volleyball-rank">-</div>
                <div class="stat-row">
                    <span class="stat-label">ì „ì  / ìŠ¹ë¥  / ì„¸íŠ¸ë“ì‹¤ë¥ </span>
                    <span class="stat-value">
                        <span id="volleyball-record">- ìŠ¹ - íŒ¨</span>
                        <span style="margin: 0 8px; color: rgba(255,255,255,0.4);">/</span>
                        <span id="volleyball-winrate">-</span>
                        <span style="margin: 0 8px; color: rgba(255,255,255,0.4);">/</span>
                        <span id="volleyball-setratio">-</span>
                    </span>
                </div>
                <div id="volleyball-next-match">
                    <div class="next-match-label">ë‹¤ìŒ ê²½ê¸°</div>
                    <div class="next-match-info">
                        <div class="no-match">ë¡œë”© ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì•¼êµ¬ ì¹´ë“œ -->
        <div class="card baseball-card" data-card-type="baseball" onclick="location.href='public/html/baseball.html'" style="cursor: pointer;">
            <div class="card-header">
                <div class="icon">âœ“</div>
                <div class="team-info">
                    <h2>í•œí™” ì´ê¸€ìŠ¤</h2>
                    <div class="league">KBO ë¦¬ê·¸</div>
                </div>
            </div>
            <div class="stats">
                <div class="rank-big" id="baseball-rank">-</div>
                <div class="stat-row">
                    <span class="stat-label">ì „ì  / ìŠ¹ë¥ </span>
                    <span class="stat-value">
                        <span id="baseball-record">ì‹œì¦Œ ì¢…ë£Œ</span>
                        <span style="margin: 0 8px; color: rgba(255,255,255,0.4);">/</span>
                        <span id="baseball-winrate">-</span>
                    </span>
                </div>
                <div id="baseball-season-info"></div>
            </div>
        </div>

        <!-- ì£¼ìš” ì´ë²¤íŠ¸ ì¹´ë“œ -->
        <div class="card events-card" data-card-type="events">
            <div class="card-header">
                <div class="icon">âœ“</div>
                <div class="team-info">
                    <h2>ì£¼ìš” ìŠ¤í¬ì¸  ì´ë²¤íŠ¸</h2>
                    <div class="league">ë‹¤ê°€ì˜¤ëŠ” ëŒ€íšŒ</div>
                </div>
            </div>
            <div class="stats">
                <div id="major-event">
                    <div style="display: flex; align-items: center; gap: 20px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <div class="event-info">
                            <div class="no-event">ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì•ˆì„¸ì˜ ì¹´ë“œ -->
        <div class="card badminton-card" data-card-type="badminton" onclick="location.href='public/html/badminton.html'" style="cursor: pointer;">
            <div class="card-header">
                <div class="icon">âœ“</div>
                <div class="team-info">
                    <h2>ì•ˆì„¸ì˜</h2>
                    <div class="league">ì„¸ê³„ 1ìœ„</div>
                </div>
            </div>
            <div class="stats">
                <div id="badminton-points"></div>
                <div id="badminton-recent-match">
                    <div class="recent-match-label">ìµœê·¼ ê²½ê¸°</div>
                    <div class="recent-match-info">
                        <div class="no-data">ë¡œë”© ì¤‘...</div>
                    </div>
                </div>
                <div id="badminton-next-match">
                    <div class="next-match-label">ë‹¤ìŒ ê²½ê¸°</div>
                    <div class="next-match-info">
                        <div class="no-match">ë¡œë”© ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¹´ë“œ ë°°ì¹˜ ë¡œì§ -->
    <script>
        let eventsChecked = false;
        let hasUpcomingEvent = false;

        // ì£¼ìš” ì´ë²¤íŠ¸ ì²´í¬ í•¨ìˆ˜
        async function checkUpcomingEvents() {
            try {
                const response = await fetch('./public/data/major-events.json');
                const events = await response.json();
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                // ì´ë²¤íŠ¸ê°€ ì˜¤ëŠ˜ ì‹œì‘í•˜ê±°ë‚˜ ì§„í–‰ ì¤‘ì¸ì§€ í™•ì¸
                const ongoingEvents = events.filter(e => {
                    const eventDate = new Date(e.date);
                    eventDate.setHours(0, 0, 0, 0);
                    
                    // ì¢…ë£Œì¼ì´ ìˆìœ¼ë©´ ê·¸ ë²”ìœ„ ì²´í¬, ì—†ìœ¼ë©´ ì‹œì‘ì¼ë§Œ ì²´í¬
                    if (e.endDate) {
                        const endDate = new Date(e.endDate);
                        endDate.setHours(0, 0, 0, 0);
                        return today >= eventDate && today <= endDate;
                    } else {
                        // ì¢…ë£Œì¼ ì—†ìœ¼ë©´ ì‹œì‘ì¼ë¶€í„° +14ì¼ ë™ì•ˆ ì§„í–‰ì¤‘ìœ¼ë¡œ ê°„ì£¼
                        const estimatedEnd = new Date(eventDate);
                        estimatedEnd.setDate(estimatedEnd.getDate() + 14);
                        return today >= eventDate && today <= estimatedEnd;
                    }
                });
                
                hasUpcomingEvent = ongoingEvents.length > 0;
                
                eventsChecked = true;
                arrangeCards();
            } catch (error) {
                console.error('ì´ë²¤íŠ¸ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                eventsChecked = true;
                arrangeCards();
            }
        }

        // ì‹œì¦Œë³„ ìš°ì„ ìˆœìœ„ ê³„ì‚°
        function calculateCardOrder() {
            const now = new Date();
            const month = now.getMonth() + 1; // 1-12
            
            const order = [];
            
            // 1. ì£¼ìš” ì´ë²¤íŠ¸ê°€ ì§„í–‰ ì¤‘ì´ë©´ ìµœìš°ì„ 
            if (hasUpcomingEvent) {
                order.push('events');
            }
            
            // 2. ì‹œì¦Œë³„ ìš°ì„ ìˆœìœ„
            const isVolleyballSeason = month >= 10 || month <= 4; // 10-4ì›”
            const isBaseballSeason = month >= 3 && month <= 10;   // 3-10ì›”
            
            if (isVolleyballSeason && !isBaseballSeason) {
                // ë°°êµ¬ ì‹œì¦Œë§Œ (11-12ì›”, 1-2ì›”)
                order.push('volleyball', 'baseball');
            } else if (isBaseballSeason && !isVolleyballSeason) {
                // ì•¼êµ¬ ì‹œì¦Œë§Œ (5-9ì›”)
                order.push('baseball', 'volleyball');
            } else {
                // ê²¹ì¹˜ëŠ” ì‹œì¦Œ (3-4ì›”, 10ì›”) - ë°°êµ¬ ìš°ì„ 
                order.push('volleyball', 'baseball');
            }
            
            // 3. ì´ë²¤íŠ¸ê°€ ì•„ì§ ì¶”ê°€ ì•ˆëìœ¼ë©´ ì¶”ê°€
            if (!hasUpcomingEvent) {
                order.push('events');
            }
            
            // 4. ì•ˆì„¸ì˜ì€ í•­ìƒ 4ë²ˆ(ë§ˆì§€ë§‰) ê³ ì •
            order.push('badminton');
            
            return order;
        }

        // ì‹œì¦Œ ì§„í–‰ ì¤‘ì¸ ìŠ¤í¬ì¸  í™•ì¸
        function getInSeasonSports() {
            const now = new Date();
            const month = now.getMonth() + 1; // 1-12
            
            const inSeason = [];
            
            // ë°°êµ¬: 10ì›”~4ì›”
            if (month >= 10 || month <= 4) {
                inSeason.push('volleyball');
            }
            
            // ì•¼êµ¬: 3ì›”~10ì›”
            if (month >= 3 && month <= 10) {
                inSeason.push('baseball');
            }
            
            // ë°°ë“œë¯¼í„´: ì—°ì¤‘ ì§„í–‰
            inSeason.push('badminton');
            
            return inSeason;
        }

        // ì¹´ë“œ ë°°ì¹˜
        function arrangeCards() {
            if (!eventsChecked) return; // ì´ë²¤íŠ¸ ì²´í¬ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            
            const order = calculateCardOrder();
            const inSeasonSports = getInSeasonSports();
            const dashboard = document.getElementById('dashboard');
            const templates = document.getElementById('card-templates');
            
            dashboard.innerHTML = '';
            
            order.forEach(cardType => {
                const card = templates.querySelector(`[data-card-type="${cardType}"]`);
                if (card) {
                    const clonedCard = card.cloneNode(true);
                    
                    // ì‹œì¦Œ ì§„í–‰ ì¤‘ì¸ ìŠ¤í¬ì¸ ì— ì£¼í™©ìƒ‰ í…Œë‘ë¦¬ ì¶”ê°€
                    if (inSeasonSports.includes(cardType)) {
                        clonedCard.classList.add('in-season');
                    }
                    
                    dashboard.appendChild(clonedCard);
                }
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë²¤íŠ¸ ì²´í¬ í›„ ì¹´ë“œ ë°°ì¹˜
        checkUpcomingEvents();
        
        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        async function displayLastUpdate() {
            console.log('ğŸ• [ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸] ì‹œê°„ ë¡œë”©...');
            
            try {
                const response = await fetch('./public/data/sports.json');
                const data = await response.json();
                
                if (data.lastUpdated) {
                    const updateTime = new Date(data.lastUpdated);
                    const formatted = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${updateTime.toLocaleString('ko-KR')}`;
                    
                    const updateElement = document.getElementById('last-update');
                    if (updateElement) {
                        updateElement.textContent = formatted;
                    }
                    
                    console.log('ğŸ• [ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸]', formatted);
                }
            } catch (error) {
                console.error('âŒ [ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸] ë¡œë”© ì‹¤íŒ¨:', error);
            }
        }
        
        // 2ì´ˆ í›„ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ (ëª¨ë“  ë°ì´í„° ë¡œë”© í›„)
        setTimeout(displayLastUpdate, 2000);
    </script>

    <!-- ì™¸ë¶€ JavaScript íŒŒì¼ ë¡œë“œ -->
    <script src="./public/js/volleyball.js"></script>
    <script src="./public/js/baseball.js"></script>
    <script src="./public/js/badminton.js"></script>
    <script src="./public/js/events.js"></script>
</body>
</html>